{% extends 'layout-nav.html' %}
{% set pageSection = "Manage user notifications" %}

{% block beforeContent %}
  <nav class="nhsuk-breadcrumb" aria-label="Breadcrumb">
    <div class="nhsuk-width-container">
      <ol class="nhsuk-breadcrumb__list">
        <li class="nhsuk-breadcrumb__item"><a class="nhsuk-breadcrumb__link" href="/notifications">Manage user notifications</a></li>
        <li class="nhsuk-breadcrumb__item">Manage user alerts</li>
      </ol>
    </div>
  </nav>
{% endblock %}

{% block headCSS %}
  <link href="/css/main.css" rel="stylesheet">
  <link href="/css/nhsuk.css" rel="stylesheet">
{% endblock %}

{% block content %}


<style>
   a:visited { 
   color:	#005eb8; 
}


.active-alert-card-action-link {
  text-decoration: none;
  cursor:pointer;
}

.active-alert-card-action-link:hover {
  color:	#7C2855;
}

    /* The Modal (background) */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  padding: 1.5em; /* Location of the box */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0, 0, 0, 0.685); /* Black w/ opacity */
}

/* Modal Content */
.modal-content {
  background-color: #fefefe;
  margin: auto;
  max-width: 640px;
  overflow: auto;
  overflow-x: hidden;
  padding: 1.5em;
  position: relative;
  width: 100%;
  height:fit-content;
}

</style>

<div class="nhsuk-grid-row">

  <div class="nhsuk-grid-column-full">
      <h1 class="nhsuk-heading-l">Manage user alerts</h1>

      <ul class="nhsuk-grid-row nhsuk-card-group nhsuk-u-padding-top-0">


    <div class="nhsuk-grid-column-one-half" id="turn-alert-on">
          <li class="beta-hub-main-topic nhsuk-card-group__item">
            <div class="nhsuk-card nhsuk-card--clickable ">
              <div class="nhsuk-card__content beta-card__content">
                  <a class="nhsuk-card__link"  href="turn-on-user-alert/select-incident">
                    <b>Turn on user alerts</b>
                  </a>
                {# <div class="nhsuk-card__description"><p>Hac habitasse platea dictumst quisque sagittis purus sit amet.</p></div> #}
                <div class="beta-hub-arrow">
                  <svg class="nhsuk-icon beta-icon__chevron-right-circle" xmlns="http://www.w3.org/2000/svg" width="27" height="27" aria-hidden="true"><circle cx="13.333" cy="13.333" r="13.333" fill=""/><g data-name="Group 1" fill="none" stroke="#fff" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2.667"><path d="M15.438 13l-3.771 3.771"/><path data-name="Path" d="M11.667 9.229L15.438 13"/></g></svg>
                </div>
              </div>
            </div>
          </li>
    </div>

</div>
</div>

<div class="nhsuk-grid-row nhsuk-u-margin-top-4" id="active" style="{% if data.active === 'true' %} display: block;{% else %} display:none;{% endif %}">

  <div class="nhsuk-grid-column-full">
    <h2 class="nhsuk-heading-m">Active user alerts</h2>

      <ul class="nhsuk-grid-row nhsuk-card-group nhsuk-u-padding-top-0">


    <div class="nhsuk-grid-column-one-half">
          
            <div class="nhsuk-card nhsuk-card ">
              <div class="nhsuk-card__content beta-card__content">
                {% if data.edit === 'true' %}
                <h3>
                  {% if data['impact'] === 'Service is not working as expected' %}
                  {% if data['is-it-planned'] === 'Yes' %}
                  <b class="nhsuk-heading-s" style="line-height: 100%;">NAM is not working as expected</b>
                  <b class="nhsuk-heading-s nhsuk-u-padding-bottom-4" style="line-height: 0%;">Planned maintenance</b>
                  {% endif %}
                  {% endif %}
                  {% if data['impact'] === 'Service is not working as expected' %}
                  {% if data['is-it-planned'] === 'No' %}
                  <b class="nhsuk-heading-s">NAM is not working as expected</b>
                  {% endif %}
                  {% endif %}
                  {% if data['impact'] === 'Service is down' %}
                  {% if data['is-it-planned'] === 'Yes' %}
                  <b class="nhsuk-heading-s" style="line-height: 100%;">NAM is down</b>
                  <b class="nhsuk-heading-s nhsuk-u-padding-bottom-4" style="line-height: 0%;">Planned maintenance</b>
                  {% endif %}
                  {% endif %}
                  {% if data['impact'] === 'Service is down' %}
                  {% if data['is-it-planned'] === 'No' %}
                  <b class="nhsuk-heading-s">NAM is down</b>
                  {% endif %}
                  {% endif %}
                </h3>
                {% else %}
                <h3>
                  {% if data.namplanned === 'true' %}
                  <b class="nhsuk-heading-s" style="line-height: 100%;">NAM is not working as expected</b>
                  <b class="nhsuk-heading-s nhsuk-u-padding-bottom-4" style="line-height: 0%;">Planned maintenance</b>
                  {% endif %}
                  {% if data.namplanned === 'false' %}
                  <b class="nhsuk-heading-s">NAM is not working as expected</b>
                  {% endif %}
                  {% if data.namdownplanned === 'true' %}
                  <b class="nhsuk-heading-s" style="line-height: 100%;">NAM is down</b>
                  <b class="nhsuk-heading-s nhsuk-u-padding-bottom-4" style="line-height: 0%;">Planned maintenance</b>
                  {% endif %}
                  {% if data.namdownplanned === 'false' %}
                  <b class="nhsuk-heading-s">NAM is down</b>
                  {% endif %}
                </h3>
                {% endif %}
                <div class="nhsuk-u-margin-top-4">
                  <div class="nhsuk-card__description " ><p style="line-height:100%;">Start date: 2 February 2023, 8am</p></div>
                  {% if data['is-it-planned'] === 'Yes' %}
                  {% if data['do-you-know-end-date-time'] === 'dontknow' %}
                  <div class="nhsuk-card__description"><p style="line-height: 50%;">End date: Not known</p></div>
                  {% endif %}
                  {% if data['do-you-know-end-date-time'] === 'both' %}
                  <div class="nhsuk-card__description"><p style="line-height: 50%;">End date: 2 February 2023, 11.30pm</p></div>
                  {% endif %}
                  {% if data['do-you-know-end-date-time'] === 'date' %}
                  <div class="nhsuk-card__description"><p style="line-height: 50%;">End date: 2 February 2023</p></div>
                  {% endif %}
                  {% endif %}
                </div>
                <div class="nhsuk-card__description nhsuk-u-margin-top-4">
                  {% if data['incident-number'] === 'No' %}
                  <a href="turn-on-user-alert/supplier-incidents/support-number" 
                    class="nhsuk-link">Add support reference number
                  </a>
                  {% else %}
                  <div class="nhsuk-card__description nhsuk-u-margin-top-6">
                    <p style="line-height:100%;">Support reference number:</p>
                    <p class="nhsuk-u-font-weight-bold" style="line-height: 0%;">ABCD12345678</p>
                  </div>

                  <div class="nhsuk-u-margin-top-4">
                    <a href="#" class="nhsuk-link">View details on Splunk</a>
                  </div>
                  
                  {% endif %}
                </div>
                <div class="nhsuk-card__description nhsuk-u-margin-top-6 nhsuk-u-margin-bottom-6">
                  <div>
                    <a  class="active-alert-card-action-link" href="edit-user-alert/incident-details?change=false&edit=false">Edit incident details</a> 
                  </div>
                  <div class="nhsuk-u-margin-top-4">
                    <a class="active-alert-card-action-link" id="openModal" >Turn off user alerts for this incident</a>
                  </div>
                </div>
                <hr class="nhsuk-section-break nhsuk-section-break--m nhsuk-section-break--visible">
                <p class="nhsuk-hint" >User alerts turned on by:</p>
                <p class="nhsuk-hint" >Admin Name on 2 February 2023</p>
              </div>
            </div>
          
    </div>

</div>
</div>

<!-- The Modal -->
<div id="myModal" class="modal">

  <!-- Modal content -->
  <div class="modal-content nhsuk-u-padding-6">
    <div id="alert-off-confirm" style="display:block;">
      {% if data.namplanned === 'true' %}
      <h1 class="nhsuk-heading-l">Do you want to turn off user alerts for this incident?
        <span class="nhsuk-heading-m nhsuk-u-padding-top-4" style="line-height: 100%;">NAM is not working as expected</span>
        <span class="nhsuk-heading-m nhsuk-u-padding-bottom-4" style="line-height: 0%;">Planned maintenance</span>
      </h1>
      {% endif %}
      {% if data.namplanned === 'false' %}
      <h1 class="nhsuk-heading-l">Do you want to turn off user alerts for this incident?
        <span class="nhsuk-heading-m nhsuk-u-padding-top-4 nhsuk-u-padding-bottom-2" style="line-height: 100%;">NAM is not working as expected</span>
      </h1>
      {% endif %}
      {% if data.namdownplanned === 'true' %}
      <h1 class="nhsuk-heading-l">Do you want to turn off user alerts for this incident?
        <span class="nhsuk-heading-m nhsuk-u-padding-top-4" style="line-height: 100%;">NAM is down</span>
        <span class="nhsuk-heading-m nhsuk-u-padding-bottom-4" style="line-height: 0%;">Planned maintenance</span>
      </h1>
      {% endif %}
      {% if data.namdownplanned === 'false' %}
      <h1 class="nhsuk-heading-l">Do you want to turn off user alerts for this incident?
        <span class="nhsuk-heading-m nhsuk-u-padding-top-4 nhsuk-u-padding-bottom-2" style="line-height: 100%;">NAM is down</span>
      </h1>
      {% endif %} 
    <div class="nhsuk-form-group nhsuk-u-margin-top-4">
                  
      <fieldset class="nhsuk-fieldset" aria-describedby="example-hint">

          <div class="nhsuk-checkboxes">
  
              <div class="nhsuk-checkboxes__item">
                  <input class="nhsuk-checkboxes__input" onclick="conFirm();" id="confirm" name="example" type="checkbox" value="">
                  {% if data.namplanned === 'true' %}
                  <label class="nhsuk-label nhsuk-checkboxes__label " for="example-1">
                        Yes, I want to turn off user alerts for this incident
                  </label>
                  {% endif %}
                  {% if data.namplanned === 'false' %}
                  <label class="nhsuk-label nhsuk-checkboxes__label " for="example-1">
                    Yes, I want to turn off user alerts for this incident
                  </label>
                  {% endif %}
                  {% if data.namdownplanned === 'true' %}
                  <label class="nhsuk-label nhsuk-checkboxes__label " for="example-1">
                    Yes, I want to turn off user alerts for this incident
                  </label>
                  {% endif %}
                  {% if data.namdownplanned === 'false' %}
                  <label class="nhsuk-label nhsuk-checkboxes__label " for="example-1">
                    Yes, I want to turn off user alerts for this incident
                  </label>
                  {% endif %}  
              </div>
          </div>
      </fieldset>
    </div> 
    <div class="form-group nhsuk-u-margin-bottom-0 nhsuk-u-margin-top-0" >
      <button class="nhsuk-button full-width nhsuk-u-margin-bottom-3 nhsuk-u-margin-top-0"  id="modal-link" style="width:100%;" 
      onclick="turnOff();" disabled="disabled">Turn off</button>
    </div>
    <div class="form-group nhsuk-u-margin-bottom-0 nhsuk-u-margin-top-0" >
        <p class="nhsuk-u-margin-bottom-0 nhsuk-u-margin-top-3 " style="display:inline-block;">
          <span class="close">
            <a  href="#" class="" id="">Cancel</a>
          </span>
        </p>
    </div>
  </div>
    <div style="display:none;" id="alert-off-feedback">
      <div style="display: flex;">
      <svg xmlns="http://www.w3.org/2000/svg" height="32px" width="32px" viewBox="0 0 512 512"><path fill="#212b32"d="M256 512c141.4 0 256-114.6 256-256S397.4 0 256 0S0 114.6 0 256S114.6 512 256 512zM216 336h24V272H216c-13.3 0-24-10.7-24-24s10.7-24 24-24h48c13.3 0 24 10.7 24 24v88h8c13.3 0 24 10.7 24 24s-10.7 24-24 24H216c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-144c-17.7 0-32-14.3-32-32s14.3-32 32-32s32 14.3 32 32s-14.3 32-32 32z"/></svg>
      <div class="nhsuk-u-padding-left-4">
        {% if data.namplanned === 'true' %}
      <h1 class="nhsuk-heading-m">User alerts have been turned off for:
        <span class="nhsuk-heading-m nhsuk-u-padding-top-4" style="line-height: 100%;">NAM is not working as expected</span>
        <span class="nhsuk-heading-m nhsuk-u-padding-bottom-3" style="line-height: 0%;">Planned maintenance</span>
      </h1>
      {% endif %}
      {% if data.namplanned === 'false' %}
      <h1 class="nhsuk-heading-m">User alerts have been turned off for:
        <span class="nhsuk-heading-m nhsuk-u-padding-top-4 " style="line-height: 100%;">NAM is not working as expected</span>
      </h1>
      {% endif %}
      {% if data.namdownplanned === 'true' %}
      <h1 class="nhsuk-heading-m">User alerts have been turned off for:
        <span class="nhsuk-heading-m nhsuk-u-padding-top-4" style="line-height: 100%;">NAM is down</span>
        <span class="nhsuk-heading-m nhsuk-u-padding-bottom-3" style="line-height: 0%;">Planned maintenance</span>
      </h1>
      {% endif %}
      {% if data.namdownplanned === 'false' %}
      <h1 class="nhsuk-heading-m">User alerts have been turned off for:
        <span class="nhsuk-heading-m nhsuk-u-padding-top-4 " style="line-height: 100%;">NAM is down</span>
      </h1>
      {% endif %}

        <div class="form-group" >
          <p style="display:inline-block;">
            <span class="">
              <a  href="/notifications/user-alerts/manage-user-alerts?active=false" class="close2" id="">Close</a>
            </span>
          </p>
        </div>
      </div>
      </div>
    </div>
  </div>

</div>

<script>
// Get the modal
var modal = document.getElementById("myModal");

// Get the button that opens the modal
var btn = document.getElementById("openModal");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// Get the <a> element that closes the feedback modal
  var a = document.getElementsByClassName("close2")[0];

// When the user clicks the button, open the modal 
btn.onclick = function() {
  modal.style.display = "flex";
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
  let inputs = document.getElementById('confirm');
  inputs.checked = false;
  document.getElementById('modal-link').setAttribute("disabled", '')
}

// When the user clicks on <a> (x), close the modal
  a.onclick = function() {
  modal.style.display = "none";
  let inputs = document.getElementById('confirm');
  inputs.checked = false;
  document.getElementById('modal-link').setAttribute("disabled", '')
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
    let inputs = document.getElementById('confirm');
    inputs.checked = false;
    document.getElementById('modal-link').setAttribute("disabled", '')


    }
  
}

function conFirm() {
        if((document.getElementById('confirm').checked)) {
            document.getElementById('modal-link').removeAttribute("disabled")
        } else {
            document.getElementById('modal-link').setAttribute("disabled", '')
        }
}

function turnOff() {
        if((document.getElementById('confirm').checked)) {
            document.getElementById('alert-off-feedback').style.display = "block";
            document.getElementById('alert-off-confirm').style.display = "none";
            document.getElementById('active').style.display = "none";
            document.getElementById('turn-alert-on').style.display = "block";
        } else {
            document.getElementById('alert-off-feedback').style.display = "none";
            document.getElementById('alert-off-confirm').style.display = "block";
            document.getElementById('active').style.display = "block";
            document.getElementById('turn-alert-on').style.display = "none";
        }
}

</script>


</div>


{% endblock %}



<!-- JavaScript hack to do nothing if search button or link href="" clicked -->
{% block pageScripts %}
<script>
  $( document ).ready(function() {
    $('a[href=""], button.nhsuk-search__submit').click(function(e) {
      e.preventDefault();
    });
  });
</script>
{% endblock %}